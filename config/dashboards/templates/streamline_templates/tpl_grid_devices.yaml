# APPLE TV
grid_atv:
  card:
    type: custom:button-card
    entity: media_player.living_room_tv
    name: >
      [[[
        if ( !entity || variables.state === 'off' ) return 'Apple TV';
        let activeChild = entity.attributes.active_child;
        return activeChild !== 'media_player.atv' ? 'Sony TV' : 'Apple TV';
      ]]]

    # double_tap_action: !include ../../shared/popup/rooms/atv_remote.yaml
    double_tap_action: !include ../../shared/popup/rooms/apple_tv_card.yaml
    hold_action: !include ../../shared/honeycomb/atv.yaml
    tap_action:
      action: call-service
      service: script.turn_on
      service_data:
        entity_id: script.atv_turn_on_off
    template:
      - mediaplayer
    variables:
      light_entity: light.sony_tv_backlight

# SAMSUNG TV
grid_samsung:
  card:
    type: custom:button-card
    entity: media_player.shield
    name: >
      [[[
        if ( !entity ) return 'Samsung';
        let source = states['media_player.shield'].attributes.source;
          if ( variables.state_on && source !==  'Android TV Launcher' )
            return source;
          else
            return 'Samsung';
      ]]]
    hold_action: !include ../../shared/honeycomb/shield.yaml
    template:
      - mediaplayer

# PLAYSTATION
grid_playstation:
  card:
    type: custom:button-card
    entity: switch.ps5_power
    name: Playstation
    template:
      - base
      - icon_ps5
      - loader
  # HOMEPODS
grid_homepods:
  card:
    type: custom:button-card
    entity: media_player.mass_universal_airplay
    template:
      - base
      - icon_homepod
      - circle
      - now_playing_bars
    styles:
      custom_fields:
        icon:
          - margin-top: -8%
      card:
        - overflow: hidden
        - --c-stroke-color-on: >
            [[[ return `rgba(${variables.vibrant_data.Vibrant_RGB}, 1)`; ]]]
        - --bar-color-top: >
            [[[ return variables.vibrant_data.LightVibrant_RGB; ]]]
        - --bar-color-bottom: >
            [[[ return variables.vibrant_data.DarkVibrant_RGB; ]]]
    variables:
      media_on: >
        [[[ return !entity || ['on', 'paused', 'idle'].indexOf(entity.state) !== -1; ]]]
      state_on: >
        [[[ return !entity || ['playing'].indexOf(entity.state) !== -1; ]]]
      circle_input: >
        [[[
          return entity === undefined || Math.round(states['sensor.currently_playing'].attributes.mass_homepods / 4 * 100 );
        ]]]
      circle_inner_text: >
        [[[
          return states['sensor.currently_playing'].attributes.mass_homepods ;
        ]]]
      circle_input_unit: ' /4'
    name: >
      [[[
        let master = states['sensor.mass_master_player'],
            attr = master.attributes;
        return !master.state || attr.sub_members_length > 1
          ? `${attr.named_master}+${attr.sub_members_length - 1}`
          : variables.state_on
            ? states[entity.attributes.active_child].attributes.friendly_name.split(' ')[0]
            : 'HomePods';
      ]]]
    double_tap_action: !include ../../shared/popup/popup_mass.yaml
    hold_action:
      action: fire-dom-event
      honeycomb_menu:
        autoclose: true
        size: 250
        variables:
          master_entity: sensor.mass_master_player
          office_entity: media_player.office_homepod
          bathroom_entity: media_player.bathroom
          bedroom_entity: media_player.bedroom
          living_room_entity: media_player.living_room_2

        buttons: !include ../../shared/honeycomb/homepods.yaml

    tap_action:
      action: >
        [[[
          return variables.state_on || variables.media_on
              ? 'call-service'
              : 'none';
        ]]]
      service: media_player.turn_off
      service_data:
        entity_id: >
          [[[
            return variables.entity_id;
          ]]]
